var dicSection = 
{
    "0" :
    {
        "과학" : "자연의 호기심에서 출발하여 원리나 법칙을 찾아내는 체계적인 지식",
        "탐구" : "경험을 바탕으로 논리적으로 궁금증의 답을 찾는 과정",
        "관찰" : "눈, 코와 같은 감각 기관이나 도구를 이용하여 탐구 대상의 특징을 자세히 살펴보는 것",
        "측정" : "도구를 사용하여 탐구 대상의 길이, 무게, 온도, 시간 등을 재는 것",
        "추리" : "주의 깊게 관찰하여 이전에 겪었던 경험, 이미 알고 있는 사실 등을 바탕으로 탐구의 결과를 설명하는 것",
        "예상" : "관찰하거나 경험한 것을 바탕으로 규칙을 찾아 앞으로 일어날 수 있는 일을 생각하는 것",
        "분류" : "탐구 대상의 공통점, 차이점을 찾아 그것을 기준으로 무리 짓는 것",
        "의사소통" : "자신이 탐구한 결과를 몸짓이나 그림 등으로 다른 사람들과 생각이나 정보를 주고받는 것"
    },
    "1" :
    {
        "물체" : "모양과 크기를 가지고 어떤 용도에 의해 만들어진 물건",
        "물질" : "물체를 만드는 재료",
        "섬유" : "가늘고 긴 실 모양의 물질",
        "감각 기관" : "몸에서 감각을 받아들이는 기관",
        "톱날" : "톱니의 날이 선 부분",
        "생활용품" : "생활에 필요한 물품",
        "향" : "꽃, 향, 향수 따위에서 나는 좋은 냄새",
        "보온" : "일정한 온도를 유지함.",
        "베이킹 소다" : "빵이나 과자를 만들 때 사용하는 식품 첨가물",
        "설계" : "계획을 세움 또는 그 계획",
        "보완" : "모자라거나 부족한 것을 보충하여 완전하게 함."
    },
    "2" :
    {
        "블록" : "쌓아 올리도록 만든 장난감",
        "화이트보드" : "칠판 펜으로 글자나 그림을 그리게 되어 있는 흰 칠판",
        "투명" : "물체가 빛을 잘 통과시킴",
        "자석의 극" : "자석에 철로 된 물체가 많이 붙는 부분",
        "탑" : "높고 뾰족하게 세운 건물",
        "N극" : "북쪽을 가리키는 자석의 극",
        "S극" : "남쪽을 가리키는 자석의 극",
        "북극" : "자석의 N극이 가리키는 지구의 북쪽 끝",
        "남극" : "자석의 S극이 가리키는 지구의 남쪽 끝",
        "내비게이션" : "지도를 보여 주거나 지름길을 찾아 주어 자동차 운전을 도와주는 프로그램",
        "나침반" : "자석의 성질을 이용하여 방향을 알려 주는 도구",
        "체험 활동" : "스스로 경험하고 느끼면서 활동하는 일",
        "회전" : "어떤 것을 중심으로 물체가 빙빙 도는 것",
        "드라이버" : "나사못을 돌려서 박거나 빼는 기구",
        "로켓" : "높은 온도와 압력의 가스가 나오는 힘을 이용한 비행물",
        "낚시" : "미끼를 꿰어 물고기를 잡는 데 쓰는 작은 쇠갈고리",
        "항해" : "배를 타고 바다 위를 다님",
        "인공위성" : "지구 둘레를 돌도록 로켓을 이용하여 쏘아 올린 장치",
        "발명품" : "아직까지 없었던 물건을 새로 생각하여 만들어 낸 것",
        "케이블" : "실이나 철사를 꼬아서 만든 굵은 줄"
    },
    "3" :
    {
        "암컷" : "암수 중에서 새끼나 알을 낳는 쪽",
        "수컷" : "암수 중에서 새끼나 알을 낳지 않는 쪽",
        "알" : "암컷이 낳은 둥근 모양의 물질. 안에서 새끼나 애벌레가 나옴.",
        "새끼" : "낳은 지 얼마 안 되는 어린 동물",
        "동물의 한 살이" : "동물이 태어나고 자라서 자손을 남기는 과정",
        "애벌레" : "알에서 나온 뒤 아직 다 자라지 않은 벌레",
        "자손" : "자식과 손자를 아울러 이르는 말",
        "어른벌레" : "다 자라서 짝짓기가 가능한 곤충",
        "허물" : "뱀, 도마뱀, 곤충 등이 자라면서 벗는 껍질",
        "번데기" : "곤충의 애벌레가 어른벌레로 되는 과정 중 한동안 가만히 들어 있는 상태의 몸",
        "곤충" : "몸이 머리, 가슴, 배 세 부분으로 구분되고 다리가 세 쌍인 동물",
        "완전 탈바꿈" : "곤충의 한살이 과정에서 번데기 단계를 거치는 것",
        "불완전 탈바꿈" : "곤충의 한살이 과정에서 번데기 단계를 거치지 않는 것",
        "꼬리" : "동물의 몸 뒤 끝에 붙어서 나와 있는 부분. 동물에 따라 조금씩 모양이 다름.",
        "임신" : "아이나 새끼를 배는 것"
    },
    "4" :
    {
        "인공위성" : "지구 주변을 돌도록 로켓을 이용하여 쏘아 올린 사람이 만든 장치",
        "일주" : "일정한 길을 한 바퀴 도는 것",
        "사막" : "비가 거의 오지 않아 식물이 자라기 어려운 땅",
        "빙하" : "오랜 시간 동안 쌓인 눈이 단단해져서 얼음덩어리로 변한 것",
        "계곡" : "좁고 길게 움푹 들어간 땅으로 물이 흐르는 골짜기",
        "호수" : "땅이 우묵하게 들어가 물이 고여 있는 곳",
        "갯벌" : "바닷물이 드나드는 바닷가에 모래나 진흙으로 되어 있는 땅",
        "폭포" : "강물이 급격히 아래로 떨어지는 물줄기",
        "화산" : "땅속의 마그마가 틈을 통해 땅의 겉면에 나와 쌓여서 만들어진 지형",
        "육지" : "지구의 표면 중 물이 덮이지 않은 곳",
        "지하수" : "빗물이 땅속에 스며들어 땅속의 흙, 돌 틈을 채우고 있는 물",
        "공기" : "지구를 둘러싸고 있는 색깔과 냄새가 없는 기체",
        "해변" : "바닷물과 땅이 서로 만나는 곳",
        "보존" : "잘 보호하여 남김.",
        "달의 바다" : "달 표면에서 주변보다 어둡게 보이는 곳",
        "충돌 구덩이" : "우주에 떠도는 운석이 부딪혀 생긴 움푹 파인 곳"
    }
};

var dicWord = 
{
    "1" : 
    {
        "감각" : "기관 몸에서 감각을 받아들이는 기관",
        "갯벌" : "바닷물이 드나드는 바닷가에 모래나 진흙으로 되어 있는 땅",
        "계곡" : "좁고 길게 움푹 들어간 땅으로 물이 흐르는 골짜기",
        "곤충" : "몸이 머리, 가슴, 배 세 부분으로 구분되고 다리가 세 쌍인 동물",
        "공기" : "지구를 둘러싸고 있는 색깔과 냄새가 없는 기체",
        "과학" : "자연의 호기심에서 출발하여 원리나 법칙을 찾아내는 체계적인 지식",
        "관찰" : "눈, 코와 같은 감각 기관이나 도구를 이용하여 탐구 대상의 특징을 자세히 살펴보는 것",
        "꼬리" : "동물의 몸 뒤 끝에 붙어서 나와 있는 부분. 동물에 따라 조금씩 모양이 다름."
    },
    "2" : 
    {
        "나침반" : "자석의 성질을 이용하여 방향을 알려 주는 도구",
        "낚시" : "미끼를 꿰어 물고기를 잡는 데 쓰는 작은 쇠갈고리",
        "남극" : "자석의 S극이 가리키는 지구의 남쪽 끝",
        "내비게이션" : "지도를 보여 주거나 지름길을 찾아 주어 자동차 운전을 도와주는 프로그램"
    },
    "3" : 
    {
        "달의 바다" : "달 표면에서 주변보다 어둡게 보이는 곳",
        "동물의 한살이" : "동물이 태어나고 자라서 자손을 남기는 과정",
        "드라이버" : "나사못을 돌려서 박거나 빼는 기구"
    },
    "4" : 
    {
        "로켓" : "높은 온도와 압력의 가스가 나오는 힘을 이용한 비행물"
    },
    "5" : 
    {
        "물질" : "물체를 만드는 재료",
        "물체" : "모양과 크기를 가지고 어떤 용도에 의해 만들어진 물건"
    },
    "6" : 
    {
        "발명품" : "아직까지 없었던 물건을 새로 생각하여 만들어 낸 것",
        "번데기" : "곤충의 애벌레가 어른벌레로 되는 과정 중 한동안 가만히 들어 있는 상태의 몸",
        "베이킹 소다" : "빵이나 과자를 만들 때 사용하는 식품 첨가물",
        "보온" : "일정한 온도를 유지함.",
        "보완" : "모자라거나 부족한 것을 보충하여 완전하게 함.",
        "보존" : "잘 보호하여 남김.",
        "북극" : "자석의 N극이 가리키는 지구의 북쪽 끝",
        "분류" : "탐구 대상의 공통점, 차이점을 찾아 그것을 기준으로 무리 짓는 것",
        "불완전 탈바꿈" : "곤충의 한살이 과정에서 번데기 단계를 거치는 것",
        "블록" : "쌓아 올리도록 만든 장난감"
    },
    "7" : 
    {
        "사막" : "비가 거의 오지 않아 식물이 자라기 어려운 땅",
        "새끼" : "낳은 지 얼마 안 되는 어린 동물",
        "생활용품" : "생활에 필요한 물품",
        "설계" : "계획을 세움 또는 그 계획",
        "섬유" : "가늘고 긴 실 모양의 물질",
        "수컷" : "암수 중에서 새끼나 알을 낳지 않는 쪽"
    },
    "8" : 
    {
        "알" : "암컷이 낳은 둥근 모양의 물질. 안에서 새끼나 애벌레가 나옴.",
        "암컷" : "암수 중에서 새끼나 알을 낳는 쪽",
        "애벌레" : "알에서 나온 뒤 아직 다 자라지 않은 벌레",
        "어른벌레" : "다 자라서 짝짓기가 가능한 곤충",
        "에스극(S극)" : "남쪽을 가리키는 자석의 극",
        "엔극(N극)" : "북쪽을 가리키는 자석의 극",
        "예상" : "관찰하거나 경험한 것을 바탕으로 규칙을 찾아 앞으로 일어날 수 있는 일을 생각하는 것",
        "완전 탈바꿈" : "곤충의 한살이 과정에서 번데기 단계를 거치는 것",
        "육지" : "지구의 표면 중 물이 덮이지 않은 곳",
        "의사소통" : "자신이 탐구한 결과를 몸짓이나 그림 등으로 다른 사람들과 생각이나 정보를 주고받는 것",
        "인공위성" : "지구 둘레를 돌도록 로켓을 이용하여 쏘아 올린 장치",
        "일주" : "일정한 길을 한 바퀴 도는 것",
        "임신" : "아이나 새끼를 배는 것"
    },
    "9" : 
    {
        "자석의 극" : "자석에 철로 된 물체가 많이 붙는 부분",
        "자손" : "자식과 손자를 아울러 이르는 말",
        "지하수" : "빗물이 땅속에 스며들어 땅속의 흙, 돌 틈을 채우고 있는 물"
    },
    "10" : 
    {
        "체험 활동" : "스스로 경험하고 느끼면서 활동하는 일",
        "추리" : "주의 깊게 관찰하여 이전에 겪었던 경험, 이미 알고 있는 사실 등을 바탕으로 탐구의 결과를 설명하는 것",
        "충돌 구덩이" : "우주에 떠도는 운석이 부딪혀 생긴 움푹 파인 곳",
        "측정" : "도구를 사용하여 탐구 대상의 길이, 무게, 온도, 시간 등을 재는 것"
    },
    "11" : 
    {
        "케이블" : "실이나 철사를 꼬아서 만든 굵은 줄"
    },
    "12" : 
    {
        "탐구" : "경험을 바탕으로 논리적으로 궁금증의 답을 찾는 과정",
        "탑" : "높고 뾰족하게 세운 건물",
        "톱날" : "톱니의 날이 선 부분",
        "투명" : "물체가 빛을 잘 통과시킴"
    },
    "13" : 
    {
        "폭포" : "강물이 급격히 아래로 떨어지는 물줄기"
    },
    "14" : 
    {
        "항해" : "배를 타고 바다 위를 다님",
        "해변" : "바닷물과 땅이 서로 만나는 곳",
        "향" : "꽃, 향, 향수 따위에서 나는 좋은 냄새",
        "허물" : "뱀, 도마뱀, 곤충 등이 자라면서 벗는 껍질",
        "호수" : "땅이 우묵하게 들어가 물이 고여 있는 곳",
        "화산" : "땅속의 마그마가 틈을 통해 땅의 겉면에 나와 쌓여서 만들어진 지형",
        "화이트보드" : "칠판 펜으로 글자나 그림을 그리게 되어 있는 흰 칠판",
        "회전" : "어떤 것을 중심으로 물체가 빙빙 도는 것"
    }
};

var dicSectionAll = {}; 
var dicWordAll = {};
var dicTab1 = dicTab2 = 0;
var dicSearchKey = "";

$(document).ready(function(){
    initDic();
    $("#btnSearchDic").click(function(){
        dicSearchKey = $("#searchDic").val();
        showDicList(1);
    });

    $("#searchDic").on('keyup', function (e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
            dicSearchKey = $(this).val();
            showDicList(1);
        }
    });

    $(".topTab > li").click(function(){
        dicSearchKey = "";
        $("#searchDic").val('');
        var tab_ = parseInt($(this).attr("data-tab"));
        $(this).siblings().removeClass("on");
        $(this).addClass("on");
        setDicTab1(tab_);
    });
    
    $(".rightTab > li").click(function(){
        dicSearchKey = "";
        $("#searchDic").val('');
        var tab_ = parseInt($(this).attr("data-tab"));
        $(this).siblings().removeClass("on");
        $(this).addClass("on");
        setDicTab2(tab_);
    });
    
});

function initDic()
{
    var sq_ = 0;
    $.each(dicSection, function(key_, obj_){
        $.each(obj_, function(word_, desc_){
            dicSectionAll[sq_] = [];
            dicSectionAll[sq_][word_] =  desc_;
            dicWordAll[word_] = desc_;
            sq_++;
        });
    });
    dicWordAll = ksort(dicWordAll);
    showDicList(1);
}

function readyDicSub(dic_)
{
    var dicList_ = {};
    var sq_ = 0;
    $.each(dic_, function(key_, val_){
        dicList_[sq_] = [];
        dicList_[sq_][key_] =  val_;
        sq_++;
    });
    return dicList_;
}

function ksort(obj)
{
    var keys = Object.keys(obj).sort()
    var sortedObj = {};
  
    for(var i in keys)
    {
        sortedObj[i] = [];
        sortedObj[i][keys[i]] = obj[keys[i]];
    }
  
    return sortedObj;
}

function showDicList(curPage)
{
    dicData = getData();

    var listPerPage = 6;
    var cntWord = Object.keys(dicData).length;
    var totalPage = parseInt(cntWord/listPerPage) + 1;
    var listStart = (listPerPage*curPage)-listPerPage;
    var html_ = "";
    var listShow = listStart+listPerPage;
    if (listShow > cntWord) listShow = cntWord;
    console.log(listPerPage, cntWord, totalPage, listStart);

    for(var i=listStart; i<(listShow); i++)
    {
        var dic_ = dicData[i];
        //html_ += '<div class="pubtree_textbox" style="overflow: auto; width: 670px; height: 100px; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: rgb(178, 178, 178); left: 0px; top: 100px;"><p class="k_dotum_m28" style="padding: 5px 0px 0px;">'+Object.keys(dic_)[0]+'</p><p class="k_dotum_m18">'+Object.values(dic_)[0]+'</p></div>';
        html_ += '<li><strong>'+Object.keys(dic_)[0]+'</strong><p>'+Object.values(dic_)[0]+'</p></li>';
    }
    //$(".dicList").eq(dicTab1).html(html_);
    $(".dicList").html(html_);
    drawPaging(curPage, totalPage);
}

function drawPaging(curPage, totalPage)
{
    var startPage = parseInt((curPage-1)/10)*10+1;
    var endPage = (startPage+10)-1;
    if (endPage > totalPage) endPage = totalPage;

    var html_ = "";
    if (startPage > 10) html_ += ' <span class="btn_prev" onclick="showDicList('+(startPage-1)+')">이전 페이지</span> ';
    for(var i=startPage; i<=endPage; i++)
    {
        html_ += (i == curPage)? ' <span class="_on">'+i+'</span> ' : ' <span onclick="showDicList('+i+')">'+i+'</span> ';
        //html_ += (i == endPage)? ' ' : ' | ';
    }
    if (endPage < totalPage) html_ += ' <span class="btn_next" onclick="showDicList('+(endPage+1)+')">다음 페이지</span> ';
    //$(".dicPaging").eq(dicTab1).html(html_);
    $(".dicPaging").html(html_);
}

function getData()
{
    if (dicSearchKey == "")
    {
        var dicData = {};
        
        switch (dicTab1)
        {
            case 0 :
                dicData = (dicTab2 > 0)? readyDicSub(dicSection[dicTab2]) : dicSectionAll;
                break;
            case 1 :
                dicData = (dicTab2 > 0)? readyDicSub(dicWord[dicTab2]) : dicWordAll;
            break;
        }
    }
    else
    {
        dicData = searchDic();
    }
    console.dir(dicData);
    return dicData;
}

function searchDic()
{
    var dicWordAll_ = {};
    var searchWord_ = searchDesc_ = dicSearchKey_ = "";
    $.each(dicSection, function(key_, obj_){
        $.each(obj_, function(word_, desc_){

            //searchWord_ = word_; // 공백 구분 검색
            //searchDesc_ = desc_; // 공백 구분 검색
            //dicSearchKey_ = dicSearchKey; // 공백 구분 검색
            searchWord_ = word_.replace(/ /g,""); // 공백 무시 검색
            searchDesc_ = desc_.replace(/ /g,""); // 공백 무시 검색
            dicSearchKey_ = dicSearchKey.replace(/ /g,""); // 공백 무시 검색

            //if (word_.indexOf(dicSearchKey) > -1) // 단어만 검색
            if ((searchWord_.indexOf(dicSearchKey_) > -1) || (searchDesc_.indexOf(dicSearchKey_) > -1)) // 단어+설명 검색
            {
                dicWordAll_[word_] = desc_;
            }
        });
    });
    return ksort(dicWordAll_);
}

function setDicTab1(tab_)
{
    dicTab1 = tab_;
    dicTab2 = 0;

    $("#p048_popupDiv_1").find(".rightTab").hide();
    switch (dicTab1)
    {
        case 0 : $("#p048_popupDiv_1").find(".unit").show(); break;
        case 1 : $("#p048_popupDiv_1").find(".alphabet").show(); break;
    }
    //$(this).siblings().not(this).css("grayscale","100%");
    //$(this).css("grayscale","0%");
    showDicList(1);
}

function setDicTab2(tab_)
{
    dicTab2 = tab_;
    showDicList(1);
}

